{#
 # Homepage template
 # ---------------
 #
 # When this template gets loaded, it will be because someone has accessed
 # http://yoursite.com/ (without any URI). Craft checks to see if you have
 # a Single section set to be the Homepage (as you do, by default), and
 # loads the section’s Template (this file). A special ‘entry’ variable
 # will already be set for you, assigned to the Homepage entry.
 #
 # It's worth noting that even if you didn't have a Homepage Single section,
 # as long as this template remains at craft/templates/index.html, it
 # would still be the one to get loaded when accessing http://yoursite.com/,
 # albeit without an ‘entry’ variable already set for you.
 #
 # See this page for more details on how Craft routes requests:
 # http://buildwithcraft.com/docs/routing
 #}

{% extends "_layout" %}

{% block content %}

  <div class="index-inspection">

    {% if currentUser.admin %}
      {% set inspections = craft.entries({ section: "inspections" }).order("dateCreated desc") %}
    {% else %}
      {% set inspections = craft.entries({ section: "inspections" }).relatedTo({ element: currentUser, field: 'mechanic' }).order("dateCreated desc") %}
    {% endif %}

    {% if inspections|length %}

    <div class="list-inspectionsTitles">
      <div class="">Vehicle</div>
      <div class="">Date</div>
      <div class="">Status</div>
    </div>
    <div class="z-depth-2">
      <ul class="list-inpsections">
      {% for inspection in inspections %}

        {% if inspection.inspectionStatus != 'UpComing' and inspection.inspectionStatus != 'Accepted' %}
          {% set status = inspection.hasCarBeenPurchased ? 'Accepted' : 'Rejected' %}
        {% else %}
          {% set status = inspection.inspectionStatus %}
        {% endif %}

        <li class="{{  status != 'UpComing' ? 'in-active':'' }}">
          {% if status == 'UpComing' %}<a href="{{inspection.url}}" class="valign-wrapper">{% endif %}
            <div class="list-item title {% if status == 'UpComing' %}title-upComing{% endif %}">{{inspection.year}} {{inspection.make}} {{inspection.model}} {{inspection.series}} <span>- {{inspection.inspectionLocation}}</span></div>
            <div class="list-item date">{{inspection.inspectionDate|date('M d') }}</div>
            <div class="list-item status-{{ status|lower }}"><span>{{ status }}</span></div>
          {% if status == 'UpComing'  %}</a>{% endif %}
          {% if status == 'Rejected' or status == 'Accepted' %}
            <div class="list-item report"><a href="/report/{{inspection.id}}">Report</a></div>
          {% endif %}
        </li>
      {% endfor %}
      </ul>
    </div>

    {% else %}
    <p class="center-align">No Inspections are currency assigned to you.</p>
    {% endif %}
  </div>

{% endblock %}
